<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Slot Game</title>
  <style>
    body { font-family: Arial, sans-serif; background: #222; color: #eee; }
    .container { max-width: 500px; margin: 40px auto; background: #333; padding: 24px; border-radius: 10px; }
    input[type=number] { width: 80px; }
    .screen { font-family: monospace; background: #111; padding: 10px; border-radius: 6px; margin-bottom: 10px; }
    .win { color: #0f0; font-weight: bold; }
    .error { color: #f55; }
    .valid { color: #0f0; }
    .balance { color: #ff0; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Slot Game</h2>
    <div class="balance">Balance: <b><%= @balance.round(2) %></b></div>
    <% if @require_deposit %>
      <div class="error">Balance is zero. Please deposit funds to start playing.</div>
    <% end %>
    <form action="/set_bet" method="post" style="margin-bottom:10px;">
      Bet: <input type="number" name="bet" min="0.01" step="0.01" value="<%= @bet %>" <%= @require_deposit ? 'disabled' : '' %>>
      <button type="submit" <%= @require_deposit ? 'disabled' : '' %>>Set Bet</button>
    </form>
    <form action="/deposit" method="post" style="margin-bottom:10px;">
      Deposit: <input type="number" name="amount" min="0.01" step="0.01">
      <button type="submit">Deposit</button>
    </form>
    <form action="/spin" method="post">
      <button type="submit" style="font-size:1.2em;" <%= @require_deposit ? 'disabled' : '' %>>Spin</button>
    </form>
    <% if @message %>
      <%= @message %>
    <% end %>
    <% if @screen_rows %>
      <div class="screen">
        <% @screen_rows.each do |row| %>
          <div><%= row.join(' ') %></div>
        <% end %>
      </div>
    <% end %>
    <% if @win %>
      <div class="win">Win: <%= @win.round(2) %></div>
    <% end %>
    <% if player_data[:history] && player_data[:history].any? %>
      <form action="/verify" method="post" style="margin-top:10px;">
        <label>Verify spin (0 = last, 1 = previous, ...):</label>
        <input type="number" name="spin_index" min="0" max="<%= player_data[:history].size - 1 %>" value="0">
        <button type="submit">Verify Game</button>
      </form>
    <% end %>
  </div>
</body>
</html>
